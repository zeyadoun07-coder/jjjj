let questionsByGrade = {
   first: [
  {q:"اعطي المعلم التلميذ كتاب .ما المفعولان؟", o:["المعلم-التلميذ","التلميذ-كتابا","اعطى-التلميذ","كتابا-المعلم"], a:"التلميذ-كتابا"},
  {q:"منح الله المؤمن أجرا الفعل منح ينصب:", o:["مفعول واحد","مفعولين","مبتداوخبر","حالاوتمييزا"], a:"مفعولين"},
  {q:"كسا الأب الفقير ثوبا المفعول به الاول هو:", o:["الاب","ثوبا","الفقير","كسا"], a:"الفقير"},
  {q:"البس الطبيب المريض ثوبا المفعول به الثاني هو:", o:["الطبيب","المريض","ألبس","ثوبا"], a:"ثوبا"},
  {q:"اي جمله فيها فعل ينصب مفعولين؟", o:["كتبَ التلميذُالدرسَ","لعبَ الطفلُ بالكرة","اعطى المدير الطالب جائزة","جلس الرجل على الكرسي"], a:"اعطى المدير الطالب جائزة"},
  {q:"سأل التلميذ المعلم سؤالا كم مفعول به في الجمله؟", o:["واحد","اثنان","ثلاثه","لايوجد"], a:"اثنان"},
  {q:"نبأ المعلم التلميذ الناجح اعرب كلمه الناجح", o:["مفعول به اول","مفعول به ثان","حال","تمييز"], a:"اثنان"},
  {q:"أي فعل من الآتي ليس من الافعال التي تنصبمفعولين؟", o:["أعطى","كسا","كتب","منح"], a:"كتب"},
 {q:"أخبر الأب أبناءه الخبرز المفعول به الأول هو:", o:["الأب","أبناءه","الخبر","أخبر"], a:"أبناءه"},
 {q:"أي جمله مما يأتي اختل فيها ترتيب المفعولين دون ان يتغير المعنى ؟", o:["منح الله المؤمن الثواب","اعطى المعلم الكتاب التلميذ","ألبس الأب الطفل معطفا","كساالغني الفقير ثوبا "], a:"اعطى المعلم الكتاب التلميذ"},
{q: "في جملة: أعطى الأبُ ابنه هديةً — ما المفعول به الأول؟",o: ["الأب", "ابنه", "هديةً", "أعطى"],a: "ابنه"},
{ q: "أي فعل من الأفعال الآتية ينصب مفعولين؟",  o: ["جلس", "ذهب", "منح", "نام"],a: "منح"},
{ q: "في جملة: كسا الشتاءُ الأرضَ ثوبًا أبيضَ — إعراب كلمة (أبيضَ)؟", o: ["مفعول به أول", "مفعول به ثانٍ", "حال", "نعت"], a: "نعت"},
{ q: "أي جملة تحتوي على فعل ينصب مفعولين؟", o: [   "لعبَ الطفلُ في الحديقة",   "كتبَ التلميذُ الدرسَ",   "ألبستِ الأمُّ الطفلَ معطفًا",   "نامَ الرجلُ مبكرًا" ], a: "ألبستِ الأمُّ الطفلَ معطفًا"},
{ q: "أي جملة اختل فيها ترتيب المفعولين دون أن يتغير المعنى؟", o: [   "منحَ اللهُ المؤمنَ الثوابَ",   "أعطى المعلمُ الكتابَ التلميذَ",   "ألبسَ الأبُ الطفلَ معطفًا",   "كسا الغنيُّ الفقيرَ ثوبًا" ], a: "أعطى المعلمُ الكتابَ التلميذَ"}
  ],
   stsec1: [
    {q:"اسلوب الاستثناء من بين الاساليب التالية هو ", o:["كن كريماً غير بخيل","عدا المتسابق بكل قوته","احب ممارسه الرياضه عدا المسارعة","اجتهد والا تندم"], a:"احب ممارسه الرياضه عدا المسارعة"},
    {q:" .ما اشتعل من الاعواد الا عود نوع جمله الاستثناء", o:["تام مثبت","تام منفي","ناقص منفي","ناقص مثبت"], a:"ناقص منفي"},
    {q:"ما فاز من المتسابقين الا متسابق-ما فاز الا متسابق من المتسابقين /اعراب كلمه متسابق على الترتيب", o:["فاعل-مستثنى","فاعل-فاعل","مستثنى-مستثنى","مستثنى-فاعل"], a:"فاعل-فاعل"},
    {q:"ما رايت الا ساعيا الى الخير/عندوضع سوى مكان الا تصبح الجمله", o:["ما رأيت سوى سوى ساعاً الى الخير","ما رايت سوى ساعٌ  الى الخير","ما رايت سوى ساعى الى الخير","ما رايت سوى ساعٍ الى الخير"], a:"ما رايت سوى ساعٍ الى الخير"},
    {q:"ما غاب الا المريض.كلمه(المريض) تعرب", o:["بدلاً","فاعلاً","مستثنا","مفعول به"], a:"فاعلاً"},
    {q:"صافحت أصدقائي عدا صديقًا. ما إعراب 'صديقًا'؟", o:["مفعول به", "فاعل", "مضاف إليه", "تمييز"], a:"مفعول به"},
{q:"حضرت الندوات عدا ندوةٍ. ما إعراب 'ندوةٍ'؟", o:["اسم مجرور", "مستثنى منصوب", "مفعول به", "الأولى والثالثة"], a:"الأولى والثالثة"},
{q:"وصل السباحون خلا...", o:["سباحٍ", "سباحُ", "سباحًا", "الثانية والثالثة"], a:"الثانية والثالثة"},
{q:"تعاون الطلاب معى إلا ...", o:["أحمدُ", "أحمدًا", "أحمدِ", "أحمدَ"], a:"أحمدَ"},
{q:"ما ازداد الفقير إلا تعلقًا بالله. ما إعراب 'تعلقًا'؟", o:["تمييز", "حال", "مفعول به ثانٍ", "مستثنى منصوب"], a:"تمييز"},
{q:"لا يُكرَم إلا ... المواهب.", o:["أُولوا", "أُولي", "أُولو", "ذوي"], a:"أُولو"},
    {q:"ما كنا إلا ....", o:["مسرورين", "مسرورون", "مسروران", "مسرورات"], a:"مسرورين"},
{q:"خلا البيت من الأحباب. حفظت القصيدة خلا بيتًا. ما إعراب 'البيت' و 'بيتًا'؟", o:["فاعل وتمييز", "مفعول به ومفعول به", "فاعل ومفعول به", "فاعل وحال"], a:"فاعل ومفعول به"},
{q:"أقبل صديقي غير نشيط. ما إعراب 'غير'؟", o:["حال", "مستثنى", "بدل", "مضاف إليه"], a:"حال"},
{q:"ما فاز بالجائزة من الطلاب إلا القليل. ما إعراب 'القليل'؟", o:["فاعل مرفوع", "مستثنى منصوب", "بدل منصوب", "بدل مجرور"], a:"فاعل مرفوع"},
{   q: "قال الشاعر: وما كانَ في الدنيا رجاءٌ لعارفٍ إلا ابتغاءُ الحقِّ في كلِّ موضعِ نوع الاستثناء:",   o: ["تام مثبت", "تام منفي", "مفرغ", "ناقص منفي"],   a: "مفرغ"},
  {  q: "قال الشاعر: وما مدحتُ القومَ إلا صادقًاإعراب كلمة (صادقًا):",  o: ["مستثنى منصوب", "حال", "بدل", "مفعول به ثانٍ"],  a: "حال"},
  {  q: "قال الشاعر: وما انتصرتْ أمةٌ إلا بعلمٍ نوع الاستثناء:",  o: ["تام مثبت", "تام منفي", "مفرغ", "ناقص مثبت"],  a: "مفرغ" },
  {   q: "قال الشاعر: وما رأيتُ مثلَ الإخلاصِ في بشرٍ إلا قلوبًا صفَتْ من كلِّ دنسِ إعراب (قلوبًا):",   o: ["مستثنى منصوب", "بدل من بشر", "مفعول به", "فاعل"],  a: "مستثنى منصوب" }
  ],
  
    prep3: [
    
  {  q: "اختر الكلمات الآتية اسم فاعل من فعل غير الثلاثي:",  o: ["لاعب", "كاتب", "مستخرج", "قائم"],  a: "مستخرج"},
  { q: "اختر اسم الفاعل من الفعل 'قرأ':",  o: ["قراءة", "قارئ", "مقروء", "قرأ"],  a: "قارئ" },
    {   q: "في جملة: 'المجتهدُ مجدٌ في عمله.'، اسم الفاعل هو:",   o: ["المجتهد", "مجد", "عمله", "في"],   a: "المجتهد" }
  ],
  rdsec3: [
{q:"اسلوب الاستثناء من بين الاساليب التالية هو ", o:["كن كريماً غير بخيل","عدا المتسابق بكل قوته","احب ممارسه الرياضه عدا المسارعة","اجتهد والا تندم"], a:"احب ممارسه الرياضه عدا المسارعة"},
 {q:" .ما اشتعل من الاعواد الا عود نوع جمله الاستثناء", o:["تام مثبت","تام منفي","ناقص منفي","ناقص مثبت"], a:"ناقص منفي"}
  ]
  
};

// ================= متغيرات =================
let qz = [];
let ans = [], i=0, t;

// ================= بدء الاختبار =================
function S(){
  let name = document.getElementById("studentName").value.trim();
  if(name === ""){
    alert("من فضلك اكتب اسمك");
    return;
  }

  if(localStorage.getItem("done_" + name) === "finished"){
    alert("لقد أكملت الاختبار بالفعل، لا يمكن إعادة الحل.");
    return;
  }

  localStorage.setItem("done_" + name, "started");

  let grade = document.getElementById("studentGrade").value;
  qz = questionsByGrade[grade];

  document.getElementById("n").innerText = name;
  document.getElementById("g").innerText = grade;
  document.getElementById("startPage").classList.remove("active");
  document.getElementById("quizPage").classList.add("active");

  showQuestion();
  startTimer();
}

// ================= عرض السؤال =================
function showQuestion() {
  let q = qz[i];
  document.getElementById("q").innerText = q.q;
  document.getElementById("qc").innerText = "السؤال " + (i+1) + " من " + qz.length;

  for (let j = 0; j < 4; j++) {
    let el = document.getElementById("o" + (j+1));
    el.innerText = q.o[j];
    el.classList.remove("selected");
    if (ans[i] === q.o[j]) el.classList.add("selected");
  }

  document.getElementById("pb").style.width = ((i+1)/qz.length*100) + "%";
}

// ================= اختيار إجابة =================
function sel(idx) {
  if(idx>=0 && idx<4){
    ans[i] = qz[i].o[idx];
    for (let j = 1; j <= 4; j++) document.getElementById("o"+j).classList.remove("selected");
    document.getElementById("o"+(idx+1)).classList.add("selected");
  } else {
    alert("اختيار غير صحيح");
  }
}

// ================= تنقل بين الأسئلة =================
function nxt(){ if(i<qz.length-1){ i++; showQuestion(); } }
function prv(){ if(i>0){ i--; showQuestion(); } }

// ================= عداد الوقت (تم التعديل) =================
function startTimer(){
  let grade = document.getElementById("studentGrade").value;

  // أوقات كل صف حسب طلبك
  let timeByGrade = {
    "first": 10*60,    // أولى إعدادي = 10 دقائق
    "prep3": 10*60,    // ثالثة إعدادي = 10 دقائق
    "stsec1": 20*60,   // أولى ثانوي = 20 دقيقة
    "rdsec3": 20*60    // ثالثة ثانوي = 20 دقيقة
  };

  let time = timeByGrade[grade]; // يجيب الوقت حسب الصف

  t = setInterval(function(){
    let minutes = Math.floor(time/60);
    let seconds = time%60;
    minutes = minutes<10?"0"+minutes:minutes;
    seconds = seconds<10?"0"+seconds:seconds;
    document.getElementById("t").innerText = minutes+":"+seconds;

    if(time<=0){ 
      clearInterval(t); 
      end(); 
    } else time--;
  },1000);
}

// ================= إنهاء الاختبار =================
function end(){
  clearInterval(t);
  document.getElementById("quizPage").classList.remove("active");
  document.getElementById("resultPage").classList.add("active");

  let s=0, r="<ul>";
  for(let x=0;x<qz.length;x++){
    let ua = ans[x]||"لم تجب";
    let ca = qz[x].a;
    let ok = (ua===ca);
    if(ok) s++;
    r += `<li>${ok?"✓":"✗"} س${x+1}: ${ua} | ${ca}</li>`;
  }
  r += "</ul>";

  document.getElementById("fs").innerText = s;
  document.getElementById("tq").innerText = qz.length;
  document.getElementById("dr").innerHTML = r;

  let name = document.getElementById("n").innerText;
  let grade = document.getElementById("g").innerText;
  let score = document.getElementById("fs").innerText;

  localStorage.setItem("done_" + name, "finished");
  sendToGoogleForm(name, grade, score);
}

// إرسال النتيجة على واتساب
function sendWhatsApp() {
  let name = document.getElementById("n").innerText;
  let grade = document.getElementById("g").innerText;
  let score = document.getElementById("fs").innerText;
  let total = document.getElementById("tq").innerText;

  let phone = "201279422387"; // رقمك مصري بصيغة دولية
  let message = `الاسم: ${name}%0Aالصف: ${grade}%0Aالدرجة: ${score} / ${total}`;

  window.open(`https://wa.me/${phone}?text=${message}`, "_blank");
}

// ================= إرسال للفورم =================
function sendToGoogleForm(name, grade, score){
  let formURL = "https://docs.google.com/forms/d/e/1FAIpQLSdZYAOUIZDxylTQygJNRL-YoLQpq0360IY0cQ8F2Gx_Tag9xw/formResponse";

  let data = new FormData();
  data.append("entry.1700652289", name);   // الاسم
  data.append("entry.982489865", grade);    // الصف
  data.append("entry.619258351", score);    // الدرجة

  fetch(formURL, { method:"POST", mode:"no-cors", body:data });

  console.log("تم إرسال البيانات للفورم!");
}